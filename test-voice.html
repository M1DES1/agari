<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Voice Chat</title>
</head>
<body>
    <h1>Test Voice Chat</h1>
    <button id="startTest">Rozpocznij test</button>
    <button id="stopTest" disabled>Zatrzymaj test</button>
    
    <div id="status">Naciśnij "Rozpocznij test"</div>
    <div id="audioLevel">Poziom audio: 0</div>
    
    <script>
        let audioContext;
        let analyser;
        let microphone;
        let javascriptNode;
        
        document.getElementById('startTest').addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true,
                    video: false 
                });
                
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);
                
                analyser.smoothingTimeConstant = 0.8;
                analyser.fftSize = 1024;
                
                microphone.connect(analyser);
                analyser.connect(javascriptNode);
                javascriptNode.connect(audioContext.destination);
                
                javascriptNode.onaudioprocess = () => {
                    const array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    
                    let values = 0;
                    for (let i = 0; i < array.length; i++) {
                        values += array[i];
                    }
                    
                    const average = values / array.length;
                    document.getElementById('audioLevel').textContent = `Poziom audio: ${Math.round(average)}`;
                    
                    if (average > 10) {
                        document.getElementById('status').innerHTML = '✅ Mikrofon działa! Mów coś...';
                        document.getElementById('status').style.color = 'green';
                    }
                };
                
                document.getElementById('startTest').disabled = true;
                document.getElementById('stopTest').disabled = false;
                document.getElementById('status').textContent = 'Mikrofon włączony - mów coś';
                
            } catch (error) {
                document.getElementById('status').textContent = `❌ Błąd: ${error.message}`;
                document.getElementById('status').style.color = 'red';
            }
        });
        
        document.getElementById('stopTest').addEventListener('click', () => {
            if (audioContext) {
                audioContext.close();
            }
            
            document.getElementById('startTest').disabled = false;
            document.getElementById('stopTest').disabled = true;
            document.getElementById('status').textContent = 'Test zatrzymany';
            document.getElementById('audioLevel').textContent = 'Poziom audio: 0';
        });
    </script>
</body>
</html>
