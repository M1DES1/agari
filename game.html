<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agario Multiplayer - Rozgrywka</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="game-container">
        <canvas id="game"></canvas>
        
        <div class="hud">
            <div class="player-info">
                <div class="player-circle" id="playerCircle"></div>
                <div class="player-stats">
                    <div class="player-name" id="playerName"></div>
                    <div class="player-size">Rozmiar: <span id="playerSize">20</span></div>
                </div>
            </div>
            
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-label">Graczy:</span>
                    <span class="stat-value" id="playersOnline">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Voice:</span>
                    <span class="stat-value" id="voiceCount">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Ranking:</span>
                    <span class="stat-value" id="playerRank">1</span>
                </div>
                <!-- DODANY ELEMENT COOLDOWN -->
                <div class="stat">
                    <span class="stat-label">Strza≈Ç:</span>
                    <span class="stat-value" id="splitCooldown">Gotowy</span>
                </div>
            </div>
            
            <div class="voice-controls">
                <button id="voiceToggle" class="voice-btn" title="Voice Chat (V)">
                    <i class="fas fa-microphone"></i>
                </button>
                <div class="voice-status" id="voiceStatus">Voice: ≈Åadowanie...</div>
                <div class="voice-indicator" id="voiceIndicator"></div>
            </div>
            
            <div class="chat-toggle" id="chatToggle" title="Czat (T)">
                <i class="fas fa-comments"></i>
                <span class="unread-badge" id="unreadBadge">0</span>
            </div>
            
            <button id="menuBtn" class="menu-btn">
                <i class="fas fa-home"></i> Menu
            </button>
        </div>
        
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> Czat</h3>
                <button class="chat-close" id="chatClose">&times;</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="system-message">
                    <i class="fas fa-info-circle"></i> Witaj na czacie! Pisz do innych graczy
                </div>
            </div>
            
            <div class="quick-emojis">
                <button class="emoji-btn" data-emoji="üëã">üëã</button>
                <button class="emoji-btn" data-emoji="üòÑ">üòÑ</button>
                <button class="emoji-btn" data-emoji="üéÆ">üéÆ</button>
                <button class="emoji-btn" data-emoji="üíÄ">üíÄ</button>
                <button class="emoji-btn" data-emoji="üçΩÔ∏è">üçΩÔ∏è</button>
                <button class="emoji-btn" data-emoji="üèÜ">üèÜ</button>
                <button class="emoji-btn" data-emoji="üí•">üí•</button>
                <button class="emoji-btn" data-emoji="üéØ">üéØ</button>
            </div>
            
            <div class="chat-input-container">
                <input type="text" 
                       id="chatInput" 
                       placeholder="Napisz wiadomo≈õƒá..." 
                       maxlength="200"
                       autocomplete="off">
                <button id="chatSend" class="chat-send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="chat-info">
                <small>Enter - wy≈õlij, ESC - zamknij czat</small>
            </div>
        </div>
        
        <div class="voice-panel">
            <div class="voice-header">
                <h3><i class="fas fa-microphone"></i> Voice Chat</h3>
                <div class="voice-range-info">
                    Zasiƒôg: <span id="voiceRangeInfo">20m</span>
                </div>
            </div>
            
            <div class="voice-users" id="voiceUsersList">
                <!-- Gracze w zasiƒôgu bƒôdƒÖ dodawani dynamicznie -->
            </div>
            
            <div class="voice-instructions">
                <div class="instruction">
                    <span class="key">V</span>
                    <span>Przytrzymaj do m√≥wienia</span>
                </div>
                <div class="instruction">
                    <span class="key">SHIFT</span>
                    <span>Strzelanie kulki</span>
                </div>
                <div class="instruction">
                    <span class="key">T</span>
                    <span>Otw√≥rz czat</span>
                </div>
            </div>
        </div>
        
        <div class="controls-hint">
            <i class="fas fa-keyboard"></i> WASD - ruch | 
            <i class="fas fa-microphone"></i> V - m√≥w | 
            <i class="fas fa-comment"></i> T - czat |
            <i class="fas fa-arrows-alt"></i> Scroll - zoom |
            <i class="fas fa-crosshairs"></i> SHIFT - strza≈Ç
        </div>
        
        <!-- MINIMAPA -->
        <div class="minimap-container">
            <div class="minimap">
                <canvas id="minimap" width="200" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Panel uprawnie≈Ñ d≈∫wiƒôku -->
    <div id="audioPermissionModal" class="permission-modal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        font-family: Arial, sans-serif;
    ">
        <div style="
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            color: white;
            border: 2px solid #3949ab;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
            animation: slideInUp 0.5s ease-out;
        ">
            <div style="font-size: 4rem; margin-bottom: 20px;">
                üîä
            </div>
            
            <h2 style="margin: 0 0 20px 0; font-size: 2rem; color: #bb86fc;">
                Uprawnienie do d≈∫wiƒôku
            </h2>
            
            <div style="
                background: rgba(255, 255, 255, 0.1);
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 30px;
                text-align: left;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            ">
                <h3 style="margin: 0 0 15px 0; color: #bb86fc; font-size: 1.3rem;">
                    <i class="fas fa-volume-up"></i> Wymagane uprawnienie
                </h3>
                <p style="margin: 0; line-height: 1.6; font-size: 1.1rem; color: #e1e1e1;">
                    Aby s≈Çyszeƒá innych graczy przez voice chat, musisz zezwoliƒá tej stronie na 
                    <strong style="color: #bb86fc;">odtwarzanie d≈∫wiƒôku</strong>.
                    <br><br>
                    D≈∫wiƒôk jest potrzebny do:
                </p>
                <ul style="margin: 15px 0 0 0; padding-left: 20px; color: #e1e1e1;">
                    <li>S≈Çyszenia innych graczy przez voice chat</li>
                    <li>Efekt√≥w d≈∫wiƒôkowych w grze</li>
                    <li>Komunikacji g≈Çosowej z innymi graczami</li>
                </ul>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;">
                <div style="display: flex; align-items: center; gap: 20px; background: rgba(76, 175, 80, 0.2); padding: 20px; border-radius: 15px; border-left: 5px solid #4CAF50;">
                    <div style="font-size: 2rem;">‚úÖ</div>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold; font-size: 1.2rem; color: #4CAF50; margin-bottom: 5px;">
                            Po w≈ÇƒÖczeniu d≈∫wiƒôku:
                        </div>
                        <div style="font-size: 0.95rem; color: #c8e6c9;">
                            Bƒôdziesz s≈Çyszeƒá innych graczy ‚Ä¢ Voice chat bƒôdzie dzia≈Çaƒá ‚Ä¢ Lepsze do≈õwiadczenie gry
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px; background: rgba(255, 152, 0, 0.2); padding: 20px; border-radius: 15px; border-left: 5px solid #FF9800;">
                    <div style="font-size: 2rem;">‚ö†Ô∏è</div>
                    <div style="text-align: left; flex: 1;">
                        <div style="font-weight: bold; font-size: 1.2rem; color: #FF9800; margin-bottom: 5px;">
                            Bez d≈∫wiƒôku:
                        </div>
                        <div style="font-size: 0.95rem; color: #ffe0b2;">
                            Nie us≈Çyszysz innych graczy ‚Ä¢ Voice chat bƒôdzie nieskuteczny ‚Ä¢ Ograniczone funkcje gry
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button id="allowAudioBtn" style="
                    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
                    color: white;
                    border: none;
                    padding: 20px 30px;
                    border-radius: 15px;
                    font-size: 1.3rem;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 15px;
                    transition: all 0.3s;
                    font-weight: bold;
                    box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
                ">
                    <span style="font-size: 1.5rem;">üîä</span>
                    <span>Zezw√≥l na odtwarzanie d≈∫wiƒôku</span>
                </button>
                
                <button id="skipAudioBtn" style="
                    background: linear-gradient(135deg, #757575 0%, #424242 100%);
                    color: white;
                    border: none;
                    padding: 18px 30px;
                    border-radius: 15px;
                    font-size: 1.1rem;
                    cursor: pointer;
                    transition: all 0.3s;
                ">
                    <span>Pomi≈Ñ na razie</span>
                </button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                <p style="margin: 0; font-size: 0.9rem; color: #bb86fc;">
                    <i class="fas fa-info-circle"></i> 
                    Mo≈ºesz zmieniƒá to ustawienie klikajƒÖc ikonƒô k≈Ç√≥dki üîí w pasku adresu
                </p>
            </div>
        </div>
    </div>
    
    <script src="game.js"></script>
    <script>
    // Skrypt dla modal uprawnie≈Ñ d≈∫wiƒôku
    document.addEventListener('DOMContentLoaded', function() {
        const audioPermissionModal = document.getElementById('audioPermissionModal');
        const allowAudioBtn = document.getElementById('allowAudioBtn');
        const skipAudioBtn = document.getElementById('skipAudioBtn');
        
        // Poka≈º modal uprawnie≈Ñ d≈∫wiƒôku
        function showAudioPermissionModal() {
            setTimeout(() => {
                audioPermissionModal.style.display = 'flex';
            }, 1500);
        }
        
        // Przycisk "Zezw√≥l na d≈∫wiƒôk"
        allowAudioBtn.addEventListener('click', async function() {
            this.innerHTML = '<span style="font-size: 1.5rem;">‚è≥</span> <span>Sprawdzanie...</span>';
            this.disabled = true;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                gainNode.gain.value = 0.001;
                oscillator.frequency.value = 440;
                oscillator.type = 'sine';
                
                oscillator.start();
                setTimeout(() => oscillator.stop(), 100);
                
                localStorage.setItem('audioPermission', 'granted');
                
                this.innerHTML = '<span style="font-size: 1.5rem;">‚úÖ</span> <span>D≈∫wiƒôk w≈ÇƒÖczony!</span>';
                this.style.background = 'linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%)';
                
                setTimeout(() => {
                    audioPermissionModal.style.animation = 'fadeOut 0.5s ease-out';
                    setTimeout(() => {
                        audioPermissionModal.style.display = 'none';
                        audioPermissionModal.style.animation = '';
                    }, 500);
                }, 1000);
                
            } catch (error) {
                console.error('B≈ÇƒÖd przyznawania uprawnie≈Ñ d≈∫wiƒôku:', error);
                this.innerHTML = '<span style="font-size: 1.5rem;">‚ùå</span> <span>B≈ÇƒÖd - spr√≥buj ponownie</span>';
                this.style.background = 'linear-gradient(135deg, #F44336 0%, #D32F2F 100%)';
                
                setTimeout(() => {
                    this.innerHTML = '<span style="font-size: 1.5rem;">üîä</span> <span>Zezw√≥l na odtwarzanie d≈∫wiƒôku</span>';
                    this.style.background = 'linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%)';
                    this.disabled = false;
                }, 2000);
            }
        });
        
        // Przycisk "Pomi≈Ñ"
        skipAudioBtn.addEventListener('click', function() {
            localStorage.setItem('audioPermission', 'skipped');
            audioPermissionModal.style.animation = 'fadeOut 0.5s ease-out';
            setTimeout(() => {
                audioPermissionModal.style.display = 'none';
                audioPermissionModal.style.animation = '';
            }, 500);
        });
        
        // Sprawd≈∫ czy trzeba pokazaƒá modal
        setTimeout(() => {
            const audioPermission = localStorage.getItem('audioPermission');
            if (!audioPermission || audioPermission === 'skipped') {
                showAudioPermissionModal();
            }
        }, 1000);
        
        // Hover efekty
        allowAudioBtn.addEventListener('mouseenter', function() {
            if (!this.disabled) {
                this.style.transform = 'translateY(-5px) scale(1.02)';
                this.style.boxShadow = '0 15px 30px rgba(76, 175, 80, 0.4)';
            }
        });
        
        allowAudioBtn.addEventListener('mouseleave', function() {
            if (!this.disabled) {
                this.style.transform = 'translateY(0) scale(1)';
                this.style.boxShadow = '0 10px 20px rgba(76, 175, 80, 0.3)';
            }
        });
        
        skipAudioBtn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 8px 15px rgba(0,0,0,0.2)';
        });
        
        skipAudioBtn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
    
    // Dodaj CSS dla animacji
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .permission-modal {
            animation: slideInUp 0.5s ease-out;
        }
        
        .minimap-container {
            position: absolute;
            top: 90px;
            left: 20px;
            z-index: 99;
        }
        
        .minimap {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid #333;
        }
        
        .minimap-header {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            text-align: center;
        }
        
        #minimap {
            border-radius: 5px;
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>
